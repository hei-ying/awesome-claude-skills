name: Sync Upstream

on:
  # 1. 设置定时任务：每小时的第0分钟执行一次
  schedule:
    - cron: '0 3 * * *'

  # 2. 允许你手动触发：
  # 在 Actions 标签页会有一个 "Run workflow" 按钮
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout fork
        uses: actions/checkout@v4
        with:
          # 1. 使用你刚创建的 PAT
          token: ${{ secrets.SYNC_PAT }}
          # 2. 确保拉取所有历史记录，以便进行 rebase
          fetch-depth: 0

      - name: Sync from upstream (rebase)
        run: |
          # 3. 替换成【源项目】的 URL
          git remote add upstream https://github.com/JayZeeDesign/awesome-claude-skills.git
          
          # 获取上游所有分支的最新状态
          git fetch upstream
          
          # 4. 替换成你【本地】和【上游】要同步的分支名 (通常是 main 或 master)
          # 注意：这里我们假设你的 fork 和上游都使用 'main' 分支
          LOCAL_BRANCH="main"
          UPSTREAM_BRANCH="main"

          # 切换到你的本地分支
          git checkout $LOCAL_BRANCH
          
          # 将你的本地分支变基到上游分支
          # 'rebase' 会让你的提交历史更整洁（相比 'merge'）
          git rebase upstream/$UPSTREAM_BRANCH
          
          # 将变基后的结果强制推送到你的 fork
          #（因为 rebase 重写了历史，所以需要 --force）
          git push origin $LOCAL_BRANCH --force